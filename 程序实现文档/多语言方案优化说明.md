# ğŸ¯ å¤šè¯­è¨€æ–¹æ¡ˆä¼˜åŒ–è¯´æ˜

## ğŸ“‹ ä¼˜åŒ–å†…å®¹

### âœ… é‡‡ç”¨æ ‡å‡†çš„ HTTP Header æ–¹å¼ä¼ é€’è¯­è¨€

**ä¼˜åŒ–å‰**:
```typescript
// âŒ åŒæ—¶ä½¿ç”¨ä¸¤ç§æ–¹å¼(å†—ä½™)
config.headers["Accept-Language"] = locale;  // Header
config.params.lang = locale;                   // Query String
```

**ä¼˜åŒ–å**:
```typescript
// âœ… åªä½¿ç”¨æ ‡å‡†çš„ Accept-Language Header
config.headers["Accept-Language"] = locale;
```

---

## ğŸ¯ ä¸ºä»€ä¹ˆè¿™æ ·ä¼˜åŒ–?

### 1. **ç¬¦åˆ HTTP æ ‡å‡†** âœ…
- `Accept-Language` æ˜¯ HTTP æ ‡å‡†è¯·æ±‚å¤´
- ç”¨äºå‘ŠçŸ¥æœåŠ¡å™¨å®¢æˆ·ç«¯æœŸæœ›çš„è¯­è¨€
- æ‰€æœ‰ä¸»æµæ¡†æ¶å’Œåº“éƒ½æ”¯æŒ

### 2. **URL æ›´ç®€æ´** âœ…
```bash
# ä¼˜åŒ–å‰
GET /api/foods?page=1&limit=20&search=&lang=en-US

# ä¼˜åŒ–å
GET /api/foods?page=1&limit=20&search=
Headers: Accept-Language: en-US
```

### 3. **å‡å°‘å‚æ•°æ±¡æŸ“** âœ…
- Query å‚æ•°ä¿ç•™ç»™ä¸šåŠ¡é€»è¾‘(page, limit, search)
- è¯­è¨€è¿™ç§å…¨å±€é…ç½®ç”¨ Header æ›´åˆé€‚
- é¿å…ä¸šåŠ¡ä»£ç å…³å¿ƒè¯­è¨€å‚æ•°

### 4. **ä¾¿äºç¼“å­˜å’Œæ—¥å¿—** âœ…
- CDN å’Œä»£ç†æœåŠ¡å™¨å¯ä»¥åŸºäº Accept-Language è¿›è¡Œç¼“å­˜
- æ—¥å¿—è®°å½•æ›´æ¸…æ™°,Header å’Œå‚æ•°åˆ†ç¦»

---

## ğŸ”§ å®ç°ç»†èŠ‚

### å‰ç«¯å®ç° (`src/utils/request.ts`)

```typescript
// è¯·æ±‚æ‹¦æˆªå™¨
request.interceptors.request.use(
  (config) => {
    // 1. æ·»åŠ è®¤è¯ Token
    const token = localStorage.getItem("token");
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }

    // 2. æ·»åŠ è¯­è¨€è®¾ç½® (é€šè¿‡æ ‡å‡† HTTP Header)
    const locale = localStorage.getItem("locale") || "zh-CN";
    config.headers["Accept-Language"] = locale;

    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);
```

**æ•ˆæœ**:
- æ‰€æœ‰è¯·æ±‚è‡ªåŠ¨æºå¸¦ `Accept-Language` header
- ä¸šåŠ¡ä»£ç æ— æ„ŸçŸ¥
- è¯­è¨€åˆ‡æ¢åç«‹å³ç”Ÿæ•ˆ

---

### åç«¯å®ç° (`src/controllers/foodController.ts`)

```typescript
export const getFoods = async (req: AuthRequest, res: Response): Promise<void> => {
  try {
    // ä»è¯·æ±‚å¤´è·å–è¯­è¨€è®¾ç½®
    const lang = (req.headers['accept-language'] as string) || 'zh-CN';

    // æ ¹æ®è¯­è¨€é€‰æ‹©å¯¹åº”å­—æ®µ
    const nameField = lang.startsWith('en')
      ? 'COALESCE(name_en, name)'
      : 'name';

    const categoryField = lang.startsWith('en')
      ? 'COALESCE(category_en, category)'
      : 'category';

    // æŸ¥è¯¢æ•°æ®...
  }
};
```

**ä¼˜ç‚¹**:
- âœ… ç»Ÿä¸€ä» `req.headers['accept-language']` è·å–
- âœ… ä¸éœ€è¦å¤„ç† query å‚æ•°
- âœ… ç¬¦åˆ RESTful è§„èŒƒ

---

## ğŸ“Š è¯·æ±‚å¯¹æ¯”

### ä¼˜åŒ–å‰çš„è¯·æ±‚

```http
GET /api/foods?page=1&limit=20&lang=zh-CN HTTP/1.1
Host: localhost:3000
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Accept-Language: zh-CN
Content-Type: application/json
```

**é—®é¢˜**: è¯­è¨€å‚æ•°åŒæ—¶å‡ºç°åœ¨ Header å’Œ Query ä¸­,å†—ä½™!

---

### ä¼˜åŒ–åçš„è¯·æ±‚

```http
GET /api/foods?page=1&limit=20 HTTP/1.1
Host: localhost:3000
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Accept-Language: zh-CN
Content-Type: application/json
```

**ä¼˜åŠ¿**:
- âœ… URL æ›´ç®€æ´
- âœ… å‚æ•°èŒè´£æ¸…æ™°
- âœ… ç¬¦åˆæ ‡å‡†è§„èŒƒ

---

## ğŸŒ Accept-Language Header è¯¦è§£

### æ ‡å‡†æ ¼å¼

```
Accept-Language: zh-CN
Accept-Language: en-US
Accept-Language: zh-CN,en;q=0.9  # æ”¯æŒå¤šä¸ªè¯­è¨€,å¸¦ä¼˜å…ˆçº§
```

### åœ¨å„ç§åœºæ™¯ä¸­çš„åº”ç”¨

#### 1. **æµè§ˆå™¨è‡ªåŠ¨å‘é€**
æµè§ˆå™¨ä¼šæ ¹æ®ç”¨æˆ·ç³»ç»Ÿè¯­è¨€è‡ªåŠ¨å‘é€ `Accept-Language`

#### 2. **CDN ç¼“å­˜**
CDN å¯ä»¥æ ¹æ® `Accept-Language` ç¼“å­˜ä¸åŒè¯­è¨€ç‰ˆæœ¬

#### 3. **æœåŠ¡ç«¯æ¸²æŸ“(SSR)**
Next.js, Nuxt.js ç­‰æ¡†æ¶éƒ½ä½¿ç”¨æ­¤ Header è¿›è¡Œè¯­è¨€æ£€æµ‹

#### 4. **å›½é™…åŒ–æ ‡å‡†**
W3C æ¨èçš„å¤šè¯­è¨€å®ç°æ–¹å¼

---

## ğŸ”„ å®Œæ•´çš„è¯­è¨€åˆ‡æ¢æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ç”¨æˆ·åœ¨è®¾ç½®é¡µé¢åˆ‡æ¢è¯­è¨€åˆ° English        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. saveLocale('en-US')                     â”‚
â”‚     â†’ localStorage.setItem('locale','en-US')â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ç”¨æˆ·è¿›å…¥é¥®é£Ÿé¡µé¢,ç‚¹å‡»"æ·»åŠ é£Ÿç‰©"         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. è°ƒç”¨ getFoods()                         â”‚
â”‚     â†’ axios.get('/api/foods')               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. è¯·æ±‚æ‹¦æˆªå™¨è‡ªåŠ¨å¤„ç†                      â”‚
â”‚     locale = localStorage.getItem('locale') â”‚
â”‚     config.headers['Accept-Language']=localeâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. å‘é€ HTTP è¯·æ±‚                          â”‚
â”‚     GET /api/foods?page=1&limit=20          â”‚
â”‚     Headers: Accept-Language: en-US         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. åç«¯æ¥æ”¶è¯·æ±‚                            â”‚
â”‚     lang = req.headers['accept-language']   â”‚
â”‚     â†’ 'en-US'                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8. æ ¹æ®è¯­è¨€æŸ¥è¯¢æ•°æ®åº“                      â”‚
â”‚     SELECT COALESCE(name_en, name) as name  â”‚
â”‚     â†’ è¿”å›è‹±æ–‡æ•°æ®                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  9. å‰ç«¯æ˜¾ç¤º                                â”‚
â”‚     { name: "Apple", category: "Fruits" }   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### ä½¿ç”¨ curl æµ‹è¯•

```bash
# æµ‹è¯•ä¸­æ–‡
curl -H "Accept-Language: zh-CN" \
     -H "Authorization: Bearer YOUR_TOKEN" \
     http://localhost:3000/api/foods

# æµ‹è¯•è‹±æ–‡
curl -H "Accept-Language: en-US" \
     -H "Authorization: Bearer YOUR_TOKEN" \
     http://localhost:3000/api/foods
```

### ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·

1. æ‰“å¼€ H5 åº”ç”¨
2. F12 â†’ Network
3. ç‚¹å‡»"æ·»åŠ é£Ÿç‰©"
4. æŸ¥çœ‹ `/api/foods` è¯·æ±‚:

**è¯·æ±‚å¤´**:
```
Accept-Language: en-US
Authorization: Bearer xxx
Content-Type: application/json
```

**URL** (ä¸åŒ…å« lang å‚æ•°):
```
http://localhost:3000/api/foods?page=1&limit=20
```

---

## ğŸ“ æ›´æ–°çš„æ–‡ä»¶

### å‰ç«¯
- âœ… `src/utils/request.ts` - ç§»é™¤ query å‚æ•°,åªä½¿ç”¨ Header

### åç«¯
- âœ… `src/controllers/foodController.ts` - åªä» Header è¯»å–è¯­è¨€

---

## ğŸ’¡ æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **å…¨å±€é…ç½®ç”¨ Header**
   - è¯­è¨€ã€æ—¶åŒºã€è®¤è¯ä¿¡æ¯

2. **ä¸šåŠ¡å‚æ•°ç”¨ Query/Body**
   - åˆ†é¡µã€æœç´¢ã€ç­›é€‰æ¡ä»¶

3. **æ•æ„Ÿä¿¡æ¯ç”¨ Header**
   - Tokenã€API Key

### âŒ é¿å…åšæ³•

1. åŒæ—¶åœ¨ Header å’Œ Query ä¼ é€’ç›¸åŒå‚æ•°
2. æŠŠè¯­è¨€å‚æ•°æ··åœ¨ä¸šåŠ¡å‚æ•°ä¸­
3. åœ¨ URL ä¸­æš´éœ²è¿‡å¤šç³»ç»Ÿé…ç½®

---

## ğŸ‰ æ€»ç»“

### ä¼˜åŒ–æˆæœ

- âœ… **URL æ›´ç®€æ´**: ç§»é™¤å†—ä½™çš„ `&lang=` å‚æ•°
- âœ… **ç¬¦åˆæ ‡å‡†**: ä½¿ç”¨æ ‡å‡†çš„ `Accept-Language` Header
- âœ… **ä»£ç æ›´ä¼˜é›…**: å‰åç«¯ç»Ÿä¸€ä» Header è·å–
- âœ… **æ˜“äºç»´æŠ¤**: å‚æ•°èŒè´£æ¸…æ™°

### å…¼å®¹æ€§

- âœ… æ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ `Accept-Language`
- âœ… Node.js/Express åŸç”Ÿæ”¯æŒè¯»å– Header
- âœ… ä¸å½±å“ç°æœ‰åŠŸèƒ½

### ä¸‹ä¸€æ­¥

1. æ‰§è¡Œæ•°æ®åº“è¿ç§»
2. å¡«å……è‹±æ–‡æ•°æ®
3. é‡å¯æœåŠ¡
4. æµ‹è¯•å¤šè¯­è¨€åˆ‡æ¢

**ä¼˜åŒ–å®Œæˆ!** ğŸš€
