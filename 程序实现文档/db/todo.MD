# 数据库脚本执行说明

## 脚本特性 ✅

### 自动清理并重新插入
脚本每次运行时会:
1. **自动删除**旧的测试数据(按外键依赖顺序)
2. **重新插入**全新的测试数据
3. **支持多次运行**,每次都是全新数据

### 已修复的问题
1. ✅ **外键约束错误** - 使用用户名动态查询用户ID
2. ✅ **重复数据错误** - 执行前先清理旧数据
3. ✅ **子查询多行错误** - 所有子查询添加`LIMIT 1`
4. ✅ **唯一约束冲突** - 先删除再插入,避免冲突

### 执行顺序
```bash
# 1. 创建数据库和表结构(首次执行)
mysql -u root -p < init_database.sql

# 2. 插入测试数据(可多次执行,每次自动清理旧数据)
mysql -u root -p < test_data.sql

# 每次运行test_data.sql都会:
# - 删除所有测试用户及其相关数据
# - 删除测试食物和分类数据
# - 重新插入全新的10条数据
```

### 数据清理流程
脚本按以下顺序自动清理:
1. 删除系统日志 (system_logs)
2. 删除用户目标 (user_goals)
3. 删除饮食记录 (diet_records)
4. 删除健康记录 (health_records)
5. 删除食物数据 (foods)
6. 删除食物分类 (food_categories)
7. 删除测试用户 (users)

### 测试数据说明
每次运行插入:
- 10个用户（密码统一为: 123456）
- 10个食物二级分类
- 10种食物（含完整营养成分）
- 10条健康记录
- 10条饮食记录
- 10个用户目标
- 10条系统日志

### 注意事项
⚠️ **重要**: 此脚本会删除特定测试用户的所有数据,不影响其他用户数据
⚠️ **管理员用户**: init_database.sql中的admin用户不会被删除

**可以安全地多次运行,每次获得全新测试数据** ✅