# 🚀 多语言数据库 - 快速实施步骤

## ⚡ 5分钟快速部署

### 步骤 1: 执行数据库迁移 (1分钟)

```bash
# 进入数据库目录
cd 程序实现文档/db

# 执行迁移脚本
mysql -u root -p health_management < migrate_add_i18n_fields.sql
```

**这个脚本会:**
- ✅ 添加 `category_en` 字段
- ✅ 添加 `sub_category_en` 字段
- ✅ 添加 `description_en` 字段
- ✅ 创建英文字段索引
- ✅ 更新全文索引支持中英文搜索

---

### 步骤 2: 填充示例英文数据 (2分钟)

```bash
# 使用示例数据脚本
mysql -u root -p health_management < sample_i18n_data.sql
```

**这个脚本会:**
- ✅ 为 10+ 个食物分类添加英文翻译
- ✅ 为常见食物添加英文名称
- ✅ 为部分食物添加英文描述
- ✅ 显示翻译完成统计

---

### 步骤 3: 重启后端服务 (1分钟)

```bash
cd 程序实现文档/backend/health-backend

# 停止现有服务 (如果在运行)
# Ctrl + C 或者
pm2 stop health-backend

# 重新启动
pnpm run dev
# 或生产环境
pnpm run pm2:start
```

---

### 步骤 4: 测试验证 (1分钟)

#### 方法 1: 使用 curl 测试

```bash
# 获取你的 token (登录后从浏览器开发者工具获取)
TOKEN="你的JWT_TOKEN"

# 测试中文接口
curl -H "Accept-Language: zh-CN" \
     -H "Authorization: Bearer $TOKEN" \
     http://localhost:3000/api/foods?limit=3

# 测试英文接口
curl -H "Accept-Language: en-US" \
     -H "Authorization: Bearer $TOKEN" \
     http://localhost:3000/api/foods?limit=3
```

#### 方法 2: 使用浏览器测试

1. 打开前端应用
2. 登录系统
3. 在设置页面切换语言为"English"
4. 进入饮食记录页面,添加食物
5. 观察食物名称和分类是否显示为英文

---

## 📊 验证结果

### 预期返回数据对比

**中文请求:**
```json
{
  "name": "苹果",
  "category": "水果",
  "description": "新鲜红苹果"
}
```

**英文请求:**
```json
{
  "name": "Apple",
  "category": "Fruits",
  "description": "Fresh red apple"
}
```

---

## 🔧 如果遇到问题

### 问题 1: 数据库迁移失败

**错误信息**: `ERROR 1060: Duplicate column name 'category_en'`

**解决方法**: 字段已存在,跳过迁移脚本,直接执行步骤 2

---

### 问题 2: 英文数据仍显示中文

**可能原因**:
1. 数据库中英文字段为空
2. 后端代码未更新
3. 前端请求头未携带语言参数

**检查步骤**:
```sql
-- 检查数据
SELECT name, name_en, category, category_en
FROM foods
WHERE name_en IS NOT NULL
LIMIT 5;
```

如果返回为空,说明需要填充英文数据:
```bash
mysql -u root -p health_management < sample_i18n_data.sql
```

---

### 问题 3: 后端服务启动失败

**检查后端代码**:
```bash
# 确认 foodController.ts 已更新
grep -n "category_en" 程序实现文档/backend/health-backend/src/controllers/foodController.ts
```

如果没有找到,说明代码未更新,重新应用代码变更。

---

## ✅ 完成检查清单

完成以下检查后,多语言功能即可正常使用:

- [ ] 数据库迁移执行成功
- [ ] 示例数据已导入
- [ ] 后端服务正常启动(无报错)
- [ ] curl 测试中文接口返回中文数据
- [ ] curl 测试英文接口返回英文数据
- [ ] 前端切换语言后数据显示正确

---

## 📁 相关文件

| 文件 | 用途 |
|------|------|
| `init_database.sql` | 完整数据库结构(含英文字段) |
| `migrate_add_i18n_fields.sql` | 迁移脚本(在现有库上添加字段) |
| `sample_i18n_data.sql` | 示例英文数据 |
| `多语言数据库实施指南.md` | 详细实施文档 |

---

## 🎯 下一步

多语言功能上线后,你可能需要:

1. **补充更多食物的英文翻译**
   - 使用翻译API批量翻译
   - 或手动整理Excel导入

2. **扩展到其他表**
   - `food_categories` 表(已有 name_en)
   - `user_goals` 表的目标描述
   - `health_records` 表的备注

3. **添加更多语言**
   - 日语: `name_ja`, `category_ja`
   - 韩语: `name_ko`, `category_ko`
   - 按相同模式扩展

---

## 💡 小贴士

- 建议在测试环境先完整测试后再部署到生产
- 定期备份数据库: `mysqldump -u root -p health_management > backup.sql`
- 可以使用 ChatGPT 等工具批量翻译食物名称
- 考虑建立翻译审核流程,确保翻译质量

---

**需要帮助?** 查看详细文档: `多语言数据库实施指南.md`

祝部署顺利! 🎉
