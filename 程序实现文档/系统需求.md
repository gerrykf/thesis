# 健康管理系统需求文档

## 1. 项目概述

### 1.1 项目背景
基于Node.js+Vue3+MySQL的个人健康打卡与饮食管理系统，采用前后端分离架构，支持移动端H5和PC端管理双端应用。

### 1.2 技术架构
- **前端移动端**: Vue3 + Vant4 + TypeScript + Pinia
- **前端管理端**: Vue3 + Element Plus + TypeScript + Pinia
- **后端API**: Node.js + Express + MySQL + JWT
- **数据库**: MySQL 8.0+

## 2. 功能需求

### 2.1 移动端H5应用 (375px设计)

#### 2.1.1 用户认证模块
**登录注册**
- 用户注册（用户名+密码+昵称）
- 用户登录（JWT认证）
- 密码找回
- 自动登录保持

**个人信息管理**
- 基本信息编辑（昵称、性别、生日、身高、目标体重、邮箱、手机号）
  - 出生日期格式化为 yyyy-MM-dd 显示
  - 后端接收 ISO 8601 格式自动转换为数据库格式
- 头像上传（支持 JPG/PNG/GIF/WEBP，最大 5MB）
  - 使用 Vant Uploader 组件
  - 上传前文件类型和大小验证
  - 实时上传状态展示（上传中/成功/失败）
  - 自动删除旧头像文件
  - 头像存储路径：`/uploads/avatars/{userId}_{timestamp}.{ext}`
  - 上传成功后自动刷新用户信息
- 账号注销

**目标设置**（首次登录引导）
- 个人信息设置
  - 年龄输入
  - 身高输入（cm）
  - 性别选择（男/女）
- 体重目标设置
  - 当前体重记录（kg）
    - 打卡时自动同步更新此值
  - 目标体重设定（kg）
  - BMI自动计算和状态评估
- 运动目标设置
  - 每日运动时长目标（分钟，建议30-60分钟）
- 睡眠目标设置
  - 每日睡眠时长目标（小时，建议7-9小时）
- 饮食目标设置
  - 每日卡路里摄入目标（kcal，建议1500-2500）
- 首次登录自动引导到目标设置
- 目标设置完成后跳转到首页
- 支持后续修改目标设置

#### 2.1.2 健康打卡模块
**今日打卡**
- 体重记录（支持小数，单位kg）
  - 自动加载上次打卡的体重作为初始值
  - 打卡成功后自动更新目标设置中的当前体重值
- 运动时长记录（单位分钟）
- 运动类型选择（跑步、游泳、瑜伽等）
- 睡眠时长记录（单位小时，支持小数）
- 睡眠质量评价（优秀、良好、一般、较差）
- 心情状态记录（很好、不错、一般、较差）
- 备注信息（文本输入）
- 日期选择（支持补录历史数据）

**数据展示**
- 今日数据概览卡片
  - 打卡状态显示（已打卡/去打卡）
  - 基于实际打卡记录判断打卡状态
  - 已打卡：显示体重、运动、睡眠、心情数据
  - 未打卡：显示引导文案和立即打卡按钮
- 历史记录列表（分页加载）
- 数据趋势图表（体重变化曲线）
- 统计分析（周报、月报）

#### 2.1.3 饮食管理模块
**食物数据库**
- 食物搜索（按名称、分类）
- 食物分类（主食、蔬菜、水果、肉类等）
- 营养信息展示（热量、蛋白质、脂肪、碳水）

**饮食记录**
- 分餐次记录（早餐、午餐、晚餐、加餐）
- 食用量输入（重量g）
- 自动营养计算
- 每日营养汇总
- 饮食历史查看

#### 2.1.4 数据分析模块
**健康统计**
- 体重变化趋势图
- 运动时长统计
- 睡眠质量分析
- BMI计算与建议

**饮食分析**
- 每日热量摄入
- 三大营养素占比
- 营养均衡评估
- 饮食建议

### 2.2 PC端管理后台

#### 2.2.1 用户管理
- 用户列表查看
- 用户详情查看
- 用户状态管理（启用/禁用）
- 用户数据统计

#### 2.2.2 食物数据管理
- 食物信息维护（增删改查）
- 食物分类管理
- 营养数据录入
- 批量导入导出

#### 2.2.3 系统统计
- 用户增长趋势
- 活跃用户统计
- 数据使用情况
- 系统运行监控

#### 2.2.4 系统设置
- 系统参数配置
- 数据备份管理
- 日志查看
- 权限管理

## 3. 界面设计需求

### 3.1 移动端H5设计规范
- **设计尺寸**: 375px宽度（iPhone X标准）
- **PC端展示**: 375px容器居中显示，两侧留白
- **移动端展示**: 全屏响应式适配
- **UI框架**: Vant4组件库
- **适配方案**: PostCSS px转rem，自动响应式

### 3.2 核心页面结构

#### 首页布局
```
┌─────────────────┐ 375px
│ 👋 你好，XXX     │
├─────────────────┤
│ 📊 今日数据      │
│ ┌─────┬─────┐   │
│ │体重  │运动  │   │
│ │65kg │30min│   │
│ └─────┴─────┘   │
│ ┌─────┬─────┐   │
│ │睡眠  │卡路里│   │
│ │8h   │1200 │   │
│ └─────┴─────┘   │
├─────────────────┤
│ 🎯 快捷操作      │
│ [健康打卡][饮食记录]│
└─────────────────┘
```

**首页今日数据展示规则**

体重数据显示优先级：
1. **默认来源**：如果用户已设置健康目标（`user_goals`表中存在`goal_type='weight'`且`status='active'`的记录），则显示该目标的`current_value`（当前体重）
2. **打卡覆盖**：如果用户当天已进行健康打卡（`health_records`表中存在当天的记录），则优先显示打卡记录中的`weight`字段
3. **兜底值**：如果以上都不存在，显示0或提示未设置

其他数据（运动时长、睡眠时长）：
- 优先从当天健康打卡记录读取
- 如无打卡记录，显示0或空值

卡路里数据：
- 从统计概览API获取当日饮食记录的卡路里总和
- 如无饮食记录，显示0

数据加载逻辑：
- 并行请求：统计概览API、健康记录API、用户目标API
- 数据组装优先级：健康记录 > 目标设置 > 默认值
- 支持下拉刷新重新加载数据

#### 底部导航
- 首页（概览）
- 健康（打卡）
- 饮食（记录）
- 历史（数据）
- 我的（设置）

**路由配置与 TabBar 控制**
- 路由 meta 配置支持 `hideFooter` 属性
- `hideFooter: true` 的页面隐藏底部导航栏
- 隐藏底部导航的页面：
  - 登录、注册页面
  - 健康打卡表单页面
  - 目标设置页面
  - 数据分析页面
  - 个人资料编辑页面
- 其他主要页面保持底部导航显示

### 3.3 管理端设计
- **布局**: 左侧菜单 + 顶部导航 + 主内容区
- **UI框架**: Element Plus
- **风格**: 简洁、专业的管理后台风格

## 4. 技术需求

### 4.1 前端技术要求

#### 移动端H5
```javascript
// 核心依赖
{
  "vue": "^3.3.0",
  "vue-router": "^4.2.0",
  "pinia": "^2.1.0",
  "vant": "^4.8.0",
  "axios": "^1.5.0",
  "typescript": "^5.0.0"
}
```

#### 开发配置
- Vite构建工具
- PostCSS px转rem自动适配
- TypeScript类型支持
- ESLint代码规范
- Prettier代码格式化

#### 适配方案
```typescript
// rem适配配置
{
  rootValue: 16,        // 根字体大小
  propList: ['*'],      // 转换所有属性
  selectorBlackList: ['.van-'], // 排除Vant组件
  minPixelValue: 2,     // 小于2px不转换
  mediaQuery: false     // 不转换媒体查询
}
```

### 4.2 后端技术要求

#### API接口设计
```javascript
// RESTful API规范

// 用户认证接口
GET    /api/auth/profile     // 获取用户信息
POST   /api/auth/login       // 用户登录
POST   /api/auth/register    // 用户注册
PUT    /api/auth/profile     // 更新用户信息
POST   /api/auth/avatar      // 上传用户头像（multipart/form-data）
PUT    /api/auth/password    // 修改密码
POST   /api/auth/logout      // 用户登出
DELETE /api/auth/account     // 注销账号

// 健康记录接口
GET    /api/health           // 获取健康记录列表
POST   /api/health           // 创建健康记录
GET    /api/health/:id       // 获取单条健康记录
PUT    /api/health/:id       // 更新健康记录
DELETE /api/health/:id       // 删除健康记录
GET    /api/health/date/:date // 获取指定日期记录

// 食物管理接口
GET    /api/foods            // 获取食物列表
GET    /api/foods/:id        // 获取单个食物信息
POST   /api/foods            // 创建食物（管理员）
PUT    /api/foods/:id        // 更新食物信息（管理员）
DELETE /api/foods/:id        // 删除食物（管理员）
GET    /api/foods/categories // 获取食物分类

// 饮食记录接口
GET    /api/diet             // 获取饮食记录
POST   /api/diet             // 创建饮食记录
GET    /api/diet/:id         // 获取单条饮食记录
PUT    /api/diet/:id         // 更新饮食记录
DELETE /api/diet/:id         // 删除饮食记录
GET    /api/diet/daily/:date // 获取每日饮食汇总

// 数据统计接口
GET    /api/stats/health     // 健康数据统计
GET    /api/stats/diet       // 饮食数据统计
GET    /api/stats/trends     // 趋势分析数据

// 管理员接口
GET    /api/admin/users      // 用户列表管理
GET    /api/admin/users/:id  // 用户详情查看
PUT    /api/admin/users/:id  // 用户状态管理
DELETE /api/admin/users/:id  // 删除用户

GET    /api/admin/foods      // 食物管理列表
POST   /api/admin/foods/import // 批量导入食物
DELETE /api/admin/foods/batch // 批量删除食物

GET    /api/admin/stats      // 系统统计数据
GET    /api/admin/logs       // 系统日志查看
POST   /api/admin/backup     // 数据备份
DELETE /api/admin/logs/:id   // 删除日志记录
```

#### 数据库设计
```sql
-- 核心数据表
users          // 用户表
health_records // 健康记录表
foods          // 食物表
diet_records   // 饮食记录表
```

### 4.3 部署需求
- **服务器**: Linux/CentOS
- **Web服务**: Nginx反向代理
- **数据库**: MySQL 8.0+
- **运行时**: Node.js 18+
- **进程管理**: PM2

## 5. 非功能需求

### 5.1 性能要求
- 页面加载时间 < 3秒
- API响应时间 < 200ms
- 支持并发用户数 > 100
- 移动端流畅度 60fps

### 5.2 兼容性要求
- **移动端**: iOS Safari 10+, Android Chrome 50+
- **PC端**: Chrome 70+, Firefox 65+, Safari 12+
- **屏幕适配**: 320px-2560px响应式

### 5.3 安全要求
- JWT token认证
- 密码bcrypt加密
- API接口CORS配置
- 输入数据验证
- XSS/CSRF防护

### 5.4 数据要求
- 数据实时性：实时同步
- 数据一致性：事务保证
- 数据备份：定期备份
- 数据恢复：快速恢复

## 6. 开发规范

### 6.1 代码规范
- TypeScript严格模式
- ESLint代码检查
- Prettier统一格式
- Git提交规范
- 代码审查机制

### 6.2 测试要求
- 单元测试覆盖率 > 80%
- 接口测试完整性
- 兼容性测试
- 性能测试验证

### 6.3 文档要求
- API接口文档
- 组件使用文档
- 部署说明文档
- 用户操作手册

## 7. 项目里程碑

### 7.1 第一阶段：基础功能 (2周)
- 用户认证系统
- 基础UI框架搭建
- 数据库设计实现
- 核心API接口

### 7.2 第二阶段：核心功能 (3周)
- 健康打卡功能
- 饮食记录功能
- 数据展示页面
- 移动端适配完善

### 7.3 第三阶段：管理后台 (2周)
- 管理员功能
- 数据统计分析
- 系统设置功能
- 后台界面完善

### 7.4 第四阶段：优化发布 (1周)
- 性能优化
- 兼容性测试
- 文档完善
- 部署上线

## 8. 验收标准

### 8.1 功能验收
- [ ] 用户可以正常注册登录
- [ ] 健康数据可以正常记录和查看
- [ ] 饮食记录功能完整可用
- [ ] 数据统计分析准确
- [ ] 管理后台功能完善

### 8.2 技术验收
- [ ] 移动端375px完美适配
- [ ] PC端居中显示效果良好
- [ ] 所有API接口正常工作
- [ ] 数据库设计合理规范
- [ ] 代码质量符合规范

### 8.3 体验验收
- [ ] 界面美观易用
- [ ] 操作流程顺畅
- [ ] 响应速度快
- [ ] 兼容性良好
- [ ] 无明显bug

这个需求文档涵盖了健康管理系统的完整功能需求、技术需求和开发规范，为后续开发工作提供了详细的指导。