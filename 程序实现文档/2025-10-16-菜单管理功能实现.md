# 菜单管理功能实现文档

## 功能概述

菜单管理模块用于管理系统的菜单结构和权限配置,只有超级管理员才能访问此模块。该模块支持树形结构的菜单管理,包括菜单和按钮两种类型。

## 实现时间
2025-10-16

## 功能特性

### 1. 菜单列表展示
- **树形表格展示**: 使用Element Plus的树形表格展示菜单层级结构
- **默认展开**: 默认展开所有菜单节点,方便查看完整结构
- **字段显示**:
  - ID: 菜单唯一标识
  - 菜单名称: 显示菜单标题
  - 图标: 可视化显示菜单图标
  - 路径: 菜单路由路径
  - 组件: Vue组件路径
  - 类型: 菜单/按钮标识
  - 排序: 菜单显示顺序
  - 状态: 启用/禁用状态

### 2. 菜单CRUD操作

#### 添加菜单
- **触发方式**: 点击"添加菜单"按钮
- **权限要求**: `menu:add` 权限
- **表单字段**:
  - 上级菜单: 使用树形选择器选择父菜单
  - 菜单名称: 必填,菜单显示名称
  - 菜单类型: 菜单/按钮(单选)
  - 路径: 菜单路由路径(菜单类型必填)
  - 组件: Vue组件路径(菜单类型必填)
  - 图标: Element Plus图标名称(菜单类型可选)
  - 权限标识: 权限code(按钮类型必填)
  - 排序: 数字,默认0
  - 状态: 启用/禁用

#### 编辑菜单
- **触发方式**: 点击列表中的"编辑"按钮
- **权限要求**: `menu:edit` 权限
- **功能**: 修改菜单的所有可编辑字段

#### 删除菜单
- **触发方式**: 点击列表中的"删除"按钮
- **权限要求**: `menu:delete` 权限
- **安全提示**: 删除确认提示,提醒子菜单也会被删除
- **级联删除**: 删除父菜单时会同时删除所有子菜单

### 3. 权限控制

#### 角色限制
- 只有`super_admin`角色可以访问菜单管理模块
- 路由级别权限控制
- 菜单级别权限控制

#### 按钮权限
- `menu:add`: 添加菜单权限
- `menu:edit`: 编辑菜单权限
- `menu:delete`: 删除菜单权限

### 4. 数据结构

#### 菜单类型
```typescript
interface Menu {
  id: number;              // 菜单ID
  parent_id: number;       // 父菜单ID, 0表示顶级菜单
  title: string;           // 菜单名称
  type: 'menu' | 'button'; // 类型
  path?: string;           // 路由路径(菜单类型)
  component?: string;      // 组件路径(菜单类型)
  icon?: string;           // 图标名称(菜单类型)
  permission?: string;     // 权限标识(按钮类型)
  sort: number;            // 排序
  status: 0 | 1;           // 状态: 0禁用, 1启用
  children?: Menu[];       // 子菜单
}
```

## 文件结构

```
frontend/health-manage/
├── src/
│   ├── router/
│   │   └── modules/
│   │       └── menu-management.ts      # 菜单管理路由配置
│   └── views/
│       └── menu-management/
│           └── index.vue               # 菜单管理主页面
```

## 路由配置

**路径**: `/menu-management/list`
**名称**: `MenuList`
**角色**: `super_admin`
**图标**: `ep:menu`

## API接口

### 获取菜单列表
- **接口**: `GET /api/admin/menus`
- **权限**: 超级管理员
- **返回**: 树形结构的菜单列表

### 创建菜单 (待实现)
- **接口**: `POST /api/admin/menus`
- **权限**: 超级管理员
- **参数**: Menu对象(不含id和children)

### 更新菜单 (待实现)
- **接口**: `PUT /api/admin/menus/:id`
- **权限**: 超级管理员
- **参数**: Menu对象

### 删除菜单 (待实现)
- **接口**: `DELETE /api/admin/menus/:id`
- **权限**: 超级管理员
- **说明**: 级联删除子菜单

## 使用说明

### 1. 访问菜单管理
1. 使用超级管理员账号登录系统
2. 在左侧导航栏找到"菜单管理"
3. 点击进入菜单管理页面

### 2. 查看菜单结构
- 页面默认展开所有菜单层级
- 可以清晰看到菜单的父子关系
- 每个菜单显示完整的配置信息

### 3. 添加新菜单
1. 点击右上角"添加菜单"按钮
2. 选择上级菜单(可选择顶级菜单)
3. 填写菜单信息:
   - 选择菜单类型(菜单/按钮)
   - 填写必填字段
   - 设置排序和状态
4. 点击"确定"保存

### 4. 编辑菜单
1. 找到要编辑的菜单行
2. 点击"编辑"按钮
3. 修改需要更改的字段
4. 点击"确定"保存

### 5. 删除菜单
1. 找到要删除的菜单行
2. 点击"删除"按钮
3. 确认删除操作
4. 注意: 删除父菜单会同时删除所有子菜单

## 注意事项

### 当前限制
1. **后端接口未完全实现**: 创建、更新、删除菜单的后端API尚未实现,前端已预留接口调用位置
2. **图标选择**: 当前需要手动输入Element Plus图标名称,未来可以添加图标选择器
3. **权限验证**: 菜单级别的权限控制已实现,但按钮级别的细粒度权限控制需要配合后端完善

### 最佳实践
1. **菜单命名**: 使用简洁明了的菜单名称
2. **路径规范**: 使用小写字母和连字符,如 `/user-management`
3. **排序规则**: 使用10的倍数(10, 20, 30...)预留扩展空间
4. **图标使用**: 为顶级菜单设置合适的图标,提升用户体验

### 安全建议
1. 仅授予可信任的用户超级管理员权限
2. 定期检查菜单配置,确保权限设置正确
3. 删除菜单前确认是否有依赖关系
4. 重要操作前做好数据备份

## 技术实现要点

### 1. 树形表格
```vue
<el-table
  :data="menuList"
  row-key="id"
  :tree-props="{ children: 'children', hasChildren: 'hasChildren' }"
  default-expand-all
>
```

### 2. 树形选择器
```vue
<el-tree-select
  v-model="menuDialog.form.parent_id"
  :data="menuTreeOptions"
  check-strictly
  clearable
/>
```

### 3. 权限指令
```vue
<el-button
  v-perms="['menu:add']"
  @click="showAddMenuDialog"
>
  添加菜单
</el-button>
```

### 4. 动态图标
```vue
<el-icon v-if="row.icon">
  <component :is="row.icon" />
</el-icon>
```

## 后续优化方向

1. **后端API完善**
   - 实现菜单的创建、更新、删除接口
   - 添加菜单唯一性验证
   - 添加路径冲突检测

2. **前端功能增强**
   - 添加图标选择器组件
   - 添加拖拽排序功能
   - 添加批量操作功能
   - 添加菜单导入导出功能

3. **用户体验优化**
   - 添加菜单预览功能
   - 添加快捷搜索功能
   - 优化表单验证提示
   - 添加操作日志记录

4. **权限管理增强**
   - 完善按钮级权限控制
   - 添加权限继承机制
   - 添加权限测试工具

## 相关文档

- [角色管理功能文档](./权限模块实现文档.md)
- [用户管理功能文档](./2025-10-16-用户角色编辑功能.md)
- [前端路由配置说明](../frontend/health-manage/src/router/README.md)

## 更新日志

### 2025-10-16
- ✅ 创建菜单管理路由配置
- ✅ 实现菜单列表页面
- ✅ 实现树形表格展示
- ✅ 实现添加/编辑菜单对话框
- ✅ 添加权限控制
- ✅ 创建功能使用文档
- ⏳ 待实现: 后端CRUD接口
- ⏳ 待实现: 图标选择器
- ⏳ 待实现: 拖拽排序
